#pragma once

/* Kernel LUT
 klut <- matrix(1/(2*pi)*exp(-0.5*((1:(4*4*50)-1)/50)),5)
 write(paste0(apply(format(klut,scientific=FALSE),2,paste0,collapse=', '),collapse=',\n'),"test.txt")
 */

namespace kernel_lut {

  static const int max_r2 = 4*4*50; // Number of bandwidths where we make K=0
  
  static const double klut[] = {0.15915494309, 0.15757132495, 0.15600346407, 0.15445120367, 0.15291438851,
                                0.15139286492, 0.14988648075, 0.14839508535, 0.14691852958, 0.14545666578,
                                0.14400934777, 0.14257643082, 0.14115777163, 0.13975322834, 0.13836266048,
                                0.13698592901, 0.13562289624, 0.13427342587, 0.13293738296, 0.13161463390,
                                0.13030504641, 0.12900848954, 0.12772483362, 0.12645395029, 0.12519571246,
                                0.12394999431, 0.12271667126, 0.12149561998, 0.12028671836, 0.11908984552,
                                0.11790488175, 0.11673170858, 0.11557020867, 0.11442026588, 0.11328176521,
                                0.11215459282, 0.11103863597, 0.10993378308, 0.10883992367, 0.10775694833,
                                0.10668474878, 0.10562321779, 0.10457224922, 0.10353173795, 0.10250157995,
                                0.10148167219, 0.10047191268, 0.09947220044, 0.09848243551, 0.09750251890,
                                0.09653235263, 0.09557183967, 0.09462088398, 0.09367939045, 0.09274726494,
                                0.09182441424, 0.09091074605, 0.09000616901, 0.08911059267, 0.08822392746,
                                0.08734608471, 0.08647697665, 0.08561651635, 0.08476461778, 0.08392119574,
                                0.08308616589, 0.08225944473, 0.08144094958, 0.08063059859, 0.07982831073,
                                0.07903400577, 0.07824760427, 0.07746902760, 0.07669819789, 0.07593503807,
                                0.07517947182, 0.07443142358, 0.07369081854, 0.07295758264, 0.07223164257,
                                0.07151292571, 0.07080136021, 0.07009687491, 0.06939939935, 0.06870886379,
                                0.06802519917, 0.06734833713, 0.06667820998, 0.06601475070, 0.06535789296,
                                0.06470757106, 0.06406371997, 0.06342627530, 0.06279517332, 0.06217035091,
                                0.06155174558, 0.06093929548, 0.06033293936, 0.05973261658, 0.05913826711,
                                0.05854983152, 0.05796725097, 0.05739046718, 0.05681942249, 0.05625405979,
                                0.05569432255, 0.05514015478, 0.05459150107, 0.05404830656, 0.05351051692,
                                0.05297807838, 0.05245093770, 0.05192904215, 0.05141233954, 0.05090077822,
                                0.05039430701, 0.04989287528, 0.04939643287, 0.04890493016, 0.04841831797,
                                0.04793654766, 0.04745957104, 0.04698734042, 0.04651980857, 0.04605692874,
                                0.04559865464, 0.04514494045, 0.04469574078, 0.04425101073, 0.04381070582,
                                0.04337478201, 0.04294319572, 0.04251590378, 0.04209286347, 0.04167403248,
                                0.04125936893, 0.04084883135, 0.04044237869, 0.04003997030, 0.03964156593,
                                0.03924712576, 0.03885661034, 0.03846998060, 0.03808719790, 0.03770822395,
                                0.03733302085, 0.03696155109, 0.03659377751, 0.03622966334, 0.03586917217,
                                0.03551226794, 0.03515891497, 0.03480907792, 0.03446272181, 0.03411981200,
                                0.03378031420, 0.03344419445, 0.03311141916, 0.03278195503, 0.03245576913,
                                0.03213282883, 0.03181310184, 0.03149655619, 0.03118316022, 0.03087288259,
                                0.03056569228, 0.03026155856, 0.02996045102, 0.02966233955, 0.02936719434,
                                0.02907498587, 0.02878568493, 0.02849926258, 0.02821569018, 0.02793493937,
                                0.02765698208, 0.02738179051, 0.02710933714, 0.02683959473, 0.02657253630,
                                0.02630813515, 0.02604636483, 0.02578719917, 0.02553061225, 0.02527657841,
                                0.02502507226, 0.02477606863, 0.02452954263, 0.02428546960, 0.02404382514,
                                0.02380458508, 0.02356772550, 0.02333322271, 0.02310105327, 0.02287119395,
                                0.02264362177, 0.02241831397, 0.02219524801, 0.02197440161, 0.02175575266,
                                0.02153927930, 0.02132495989, 0.02111277300, 0.02090269739, 0.02069471208,
                                0.02048879625, 0.02028492933, 0.02008309091, 0.01988326081, 0.01968541906,
                                0.01948954587, 0.01929562165, 0.01910362700, 0.01891354274, 0.01872534985,
                                0.01853902950, 0.01835456308, 0.01817193212, 0.01799111838, 0.01781210376,
                                0.01763487036, 0.01745940047, 0.01728567653, 0.01711368118, 0.01694339721,
                                0.01677480759, 0.01660789546, 0.01644264414, 0.01627903710, 0.01611705797,
                                0.01595669057, 0.01579791884, 0.01564072692, 0.01548509909, 0.01533101978,
                                0.01517847359, 0.01502744525, 0.01487791967, 0.01472988190, 0.01458331712,
                                0.01443821069, 0.01429454810, 0.01415231497, 0.01401149708, 0.01387208035,
                                0.01373405085, 0.01359739476, 0.01346209842, 0.01332814830, 0.01319553101,
                                0.01306423328, 0.01293424199, 0.01280554413, 0.01267812684, 0.01255197737,
                                0.01242708311, 0.01230343157, 0.01218101038, 0.01205980730, 0.01193981021,
                                0.01182100711, 0.01170338613, 0.01158693549, 0.01147164356, 0.01135749880,
                                0.01124448979, 0.01113260525, 0.01102183398, 0.01091216490, 0.01080358704,
                                0.01069608956, 0.01058966169, 0.01048429279, 0.01037997234, 0.01027668989,
                                0.01017443511, 0.01007319779, 0.00997296780, 0.00987373511, 0.00977548981,
                                0.00967822206, 0.00958192214, 0.00948658042, 0.00939218737, 0.00929873354,
                                0.00920620960, 0.00911460628, 0.00902391443, 0.00893412498, 0.00884522896,
                                0.00875721746, 0.00867008169, 0.00858381293, 0.00849840257, 0.00841384205,
                                0.00833012292, 0.00824723681, 0.00816517544, 0.00808393058, 0.00800349413,
                                0.00792385803, 0.00784501433, 0.00776695513, 0.00768967264, 0.00761315912,
                                0.00753740692, 0.00746240846, 0.00738815626, 0.00731464288, 0.00724186096,
                                0.00716980324, 0.00709846251, 0.00702783163, 0.00695790353, 0.00688867124,
                                0.00682012781, 0.00675226641, 0.00668508023, 0.00661856257, 0.00655270678,
                                0.00648750625, 0.00642295449, 0.00635904502, 0.00629577147, 0.00623312750,
                                0.00617110684, 0.00610970330, 0.00604891074, 0.00598872307, 0.00592913428,
                                0.00587013841, 0.00581172956, 0.00575390188, 0.00569664960, 0.00563996699,
                                0.00558384838, 0.00552828816, 0.00547328077, 0.00541882072, 0.00536490255,
                                0.00531152088, 0.00525867037, 0.00520634572, 0.00515454172, 0.00510325317,
                                0.00505247495, 0.00500220199, 0.00495242924, 0.00490315175, 0.00485436457,
                                0.00480606284, 0.00475824172, 0.00471089642, 0.00466402222, 0.00461761442,
                                0.00457166839, 0.00452617953, 0.00448114329, 0.00443655517, 0.00439241071,
                                0.00434870549, 0.00430543515, 0.00426259535, 0.00422018182, 0.00417819031,
                                0.00413661662, 0.00409545660, 0.00405470612, 0.00401436112, 0.00397441756,
                                0.00393487145, 0.00389571882, 0.00385695577, 0.00381857842, 0.00378058293,
                                0.00374296550, 0.00370572237, 0.00366884982, 0.00363234415, 0.00359620173,
                                0.00356041892, 0.00352499216, 0.00348991790, 0.00345519264, 0.00342081290,
                                0.00338677524, 0.00335307627, 0.00331971260, 0.00328668091, 0.00325397789,
                                0.00322160026, 0.00318954481, 0.00315780830, 0.00312638759, 0.00309527951,
                                0.00306448097, 0.00303398887, 0.00300380018, 0.00297391187, 0.00294432095,
                                0.00291502447, 0.00288601949, 0.00285730311, 0.00282887247, 0.00280072472,
                                0.00277285704, 0.00274526666, 0.00271795080, 0.00269090673, 0.00266413176,
                                0.00263762321, 0.00261137842, 0.00258539477, 0.00255966966, 0.00253420053,
                                0.00250898481, 0.00248401999, 0.00245930358, 0.00243483310, 0.00241060611,
                                0.00238662018, 0.00236287291, 0.00233936193, 0.00231608489, 0.00229303946,
                                0.00227022334, 0.00224763424, 0.00222526990, 0.00220312810, 0.00218120661,
                                0.00215950324, 0.00213801582, 0.00211674221, 0.00209568027, 0.00207482790,
                                0.00205418302, 0.00203374356, 0.00201350747, 0.00199347274, 0.00197363735,
                                0.00195399933, 0.00193455672, 0.00191530755, 0.00189624993, 0.00187738192,
                                0.00185870166, 0.00184020727, 0.00182189690, 0.00180376873, 0.00178582093,
                                0.00176805171, 0.00175045930, 0.00173304194, 0.00171579789, 0.00169872541,
                                0.00168182281, 0.00166508840, 0.00164852049, 0.00163211744, 0.00161587760,
                                0.00159979935, 0.00158388108, 0.00156812120, 0.00155251813, 0.00153707032,
                                0.00152177621, 0.00150663428, 0.00149164302, 0.00147680093, 0.00146210651,
                                0.00144755831, 0.00143315486, 0.00141889473, 0.00140477650, 0.00139079874,
                                0.00137696006, 0.00136325908, 0.00134969442, 0.00133626474, 0.00132296868,
                                0.00130980492, 0.00129677215, 0.00128386905, 0.00127109434, 0.00125844674,
                                0.00124592498, 0.00123352782, 0.00122125402, 0.00120910234, 0.00119707157,
                                0.00118516050, 0.00117336796, 0.00116169275, 0.00115013372, 0.00113868970,
                                0.00112735954, 0.00111614213, 0.00110503633, 0.00109404104, 0.00108315514,
                                0.00107237757, 0.00106170724, 0.00105114307, 0.00104068402, 0.00103032905,
                                0.00102007710, 0.00100992716, 0.00099987822, 0.00098992927, 0.00098007930,
                                0.00097032735, 0.00096067243, 0.00095111358, 0.00094164985, 0.00093228027,
                                0.00092300393, 0.00091381989, 0.00090472723, 0.00089572504, 0.00088681243,
                                0.00087798850, 0.00086925236, 0.00086060316, 0.00085204001, 0.00084356208,
                                0.00083516849, 0.00082685843, 0.00081863105, 0.00081048553, 0.00080242107,
                                0.00079443684, 0.00078653207, 0.00077870594, 0.00077095769, 0.00076328653,
                                0.00075569170, 0.00074817244, 0.00074072800, 0.00073335764, 0.00072606061,
                                0.00071883618, 0.00071168364, 0.00070460227, 0.00069759136, 0.00069065021,
                                0.00068377813, 0.00067697442, 0.00067023841, 0.00066356943, 0.00065696680,
                                0.00065042988, 0.00064395799, 0.00063755050, 0.00063120677, 0.00062492616,
                                0.00061870804, 0.00061255179, 0.00060645680, 0.00060042245, 0.00059444815,
                                0.00058853329, 0.00058267729, 0.00057687955, 0.00057113950, 0.00056545657,
                                0.00055983018, 0.00055425978, 0.00054874480, 0.00054328470, 0.00053787893,
                                0.00053252694, 0.00052722821, 0.00052198220, 0.00051678839, 0.00051164626,
                                0.00050655530, 0.00050151499, 0.00049652483, 0.00049158433, 0.00048669298,
                                0.00048185030, 0.00047705581, 0.00047230903, 0.00046760947, 0.00046295668,
                                0.00045835019, 0.00045378953, 0.00044927424, 0.00044480389, 0.00044037802,
                                0.00043599618, 0.00043165795, 0.00042736288, 0.00042311055, 0.00041890053,
                                0.00041473240, 0.00041060574, 0.00040652015, 0.00040247520, 0.00039847051,
                                0.00039450566, 0.00039058026, 0.00038669393, 0.00038284626, 0.00037903687,
                                0.00037526539, 0.00037153144, 0.00036783464, 0.00036417462, 0.00036055103,
                                0.00035696348, 0.00035341164, 0.00034989513, 0.00034641362, 0.00034296675,
                                0.00033955417, 0.00033617555, 0.00033283055, 0.00032951883, 0.00032624006,
                                0.00032299392, 0.00031978007, 0.00031659821, 0.00031344800, 0.00031032914,
                                0.00030724132, 0.00030418422, 0.00030115753, 0.00029816096, 0.00029519421,
                                0.00029225698, 0.00028934898, 0.00028646991, 0.00028361948, 0.00028079742,
                                0.00027800344, 0.00027523726, 0.00027249860, 0.00026978720, 0.00026710277,
                                0.00026444505, 0.00026181378, 0.00025920869, 0.00025662952, 0.00025407601,
                                0.00025154792, 0.00024904497, 0.00024656693, 0.00024411355, 0.00024168458,
                                0.00023927978, 0.00023689891, 0.00023454172, 0.00023220799, 0.00022989748,
                                0.00022760997, 0.00022534521, 0.00022310299, 0.00022088308, 0.00021868525,
                                0.00021650930, 0.00021435499, 0.00021222213, 0.00021011048, 0.00020801985,
                                0.00020595001, 0.00020390078, 0.00020187193, 0.00019986327, 0.00019787460,
                                0.00019590571, 0.00019395642, 0.00019202652, 0.00019011582, 0.00018822414,
                                0.00018635128, 0.00018449705, 0.00018266128, 0.00018084377, 0.00017904434,
                                0.00017726282, 0.00017549903, 0.00017375278, 0.00017202391, 0.00017031225,
                                0.00016861761, 0.00016693984, 0.00016527876, 0.00016363421, 0.00016200602,
                                0.00016039403, 0.00015879809, 0.00015721802, 0.00015565367, 0.00015410489,
                                0.00015257152, 0.00015105341, 0.00014955040, 0.00014806235, 0.00014658911,
                                0.00014513052, 0.00014368645, 0.00014225675, 0.00014084127, 0.00013943987,
                                0.00013805242, 0.00013667878, 0.00013531880, 0.00013397236, 0.00013263931,
                                0.00013131953, 0.00013001288, 0.00012871923, 0.00012743845, 0.00012617041,
                                0.00012491500, 0.00012367207, 0.00012244152, 0.00012122320, 0.00012001701,
                                0.00011882282, 0.00011764052, 0.00011646997, 0.00011531108, 0.00011416371,
                                0.00011302776, 0.00011190312, 0.00011078966, 0.00010968729, 0.00010859588,
                                0.00010751534, 0.00010644554, 0.00010538639, 0.00010433778, 0.00010329960,
                                0.00010227175, 0.00010125413, 0.00010024663, 0.00009924916, 0.00009826162,
                                0.00009728390, 0.00009631591, 0.00009535755, 0.00009440872, 0.00009346934,
                                0.00009253931, 0.00009161853, 0.00009070691, 0.00008980436, 0.00008891079,
                                0.00008802611, 0.00008715024, 0.00008628308, 0.00008542455, 0.00008457456,
                                0.00008373303, 0.00008289987, 0.00008207500, 0.00008125834, 0.00008044981,
                                0.00007964932, 0.00007885680, 0.00007807216, 0.00007729533, 0.00007652622,
                                0.00007576478, 0.00007501090, 0.00007426453, 0.00007352559, 0.00007279400,
                                0.00007206968, 0.00007135258, 0.00007064261, 0.00006993970, 0.00006924379,
                                0.00006855480, 0.00006787267, 0.00006719733, 0.00006652870, 0.00006586673,
                                0.00006521135, 0.00006456248, 0.00006392008, 0.00006328406, 0.00006265437,
                                0.00006203095, 0.00006141373, 0.00006080266, 0.00006019766, 0.00005959868,
                                0.00005900567, 0.00005841855, 0.00005783728, 0.00005726179, 0.00005669202,
                                0.00005612793, 0.00005556944, 0.00005501652, 0.00005446910, 0.00005392712};

  inline double K(double x, double y, double h) {
    int r2 = (int)((x*x+y*y)/(h*h)*50);
    return (r2 < max_r2) ? klut[r2]/(h*h) : 0;
  }
};
